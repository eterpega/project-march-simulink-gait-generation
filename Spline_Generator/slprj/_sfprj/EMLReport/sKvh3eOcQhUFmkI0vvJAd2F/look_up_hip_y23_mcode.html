<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="18,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S2T0U3">angleHip</span>, <span class="var type0" id="S3T0U4">y</span>] = look_up_hip_y(<span class="var type1" id="S4T1U7">knee_spline</span>, <span class="var type1" id="S5T1U8">x_spline</span>, <span class="var type1" id="S6T1U9">table_hip</span>, <span class="var type1" id="S7T1U10">table_knee</span>, <span class="var type1" id="S8T3U11">table_x</span>, <span class="var type1" id="S9T3U12">table_y</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="18,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%This looks up y and hip angle based on knee angle and x</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% first we extend the knee angle array to a matrix of N x spline_points</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% where N is the size of the look up table</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%easier</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T16:U7"><span class="var type1" id="S4T16U15">knee_spline</span> = <span class="mxinfo " id="T16:U9"><span class="var type1" id="S4T1U17">knee_spline</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="18,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T16:U11"><span class="var type1" id="S5T16U20">x_spline</span> = <span class="mxinfo " id="T16:U13"><span class="var type1" id="S5T1U22">x_spline</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="18,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T3:U15"><span class="var type1" id="S10T3U25">angleKnee_spline_ext</span> = <span class="mxinfo " id="T3:U17">zeros(<span class="mxinfo " id="T4:U18">length(<span class="mxinfo " id="T16:U19"><span class="var type1" id="S9T3U31">table_y</span>(<span class="mxinfo " id="T4:U21">1</span>,<span class="mxinfo " id="T12:U22">:</span>)</span>)</span>, <span class="mxinfo " id="T4:U23">size(<span class="var type1" id="S4T16U36">knee_spline</span>,2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="18,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,13" id="srcline13">13</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S14T4U40">i</span> = <span class="mxinfo " id="T1:U26"><span class="mxinfo " id="T4:U27">1</span>:<span class="mxinfo " id="T4:U28">length(<span class="var type1" id="S4T16U45">knee_spline</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="18,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T1:U30"><span class="mxinfo " id="T1:U31"><span class="var type1" id="S10T3U49">angleKnee_spline_ext</span>(<span class="mxinfo " id="T12:U33">:</span>, <span class="var type1" id="S14T4U51">i</span>)</span> =  <span class="mxinfo " id="T4:U35"><span class="var type1" id="S4T16U53">knee_spline</span>(<span class="var type1" id="S14T4U54">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="18,15" id="srcline15">15</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,17" id="srcline17">17</a></span><span class="line"><span class="comment">%with this extended spline data (all the rows in a column just have the</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,18" id="srcline18">18</a></span><span class="line"><span class="comment">%same value, this is needed to find the minimum in a row w.r.t. to this</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,19" id="srcline19">19</a></span><span class="line"><span class="comment">%spline point.</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,20" id="srcline20">20</a></span><span class="line"><span class="comment">%find row index in look up table which is closest to given knee angle</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,21" id="srcline21">21</a></span><span class="line"><span class="var type0" id="S15T0U57">differences</span> = abs(<span class="message error" id="M4F23C"><span class="var type1" id="S7T1U61">table_knee</span> - <span class="var type1" id="S10T3U62">angleKnee_spline_ext</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="18,22" id="srcline22">22</a></span><span class="line">[<span class="message error" id="M6F23C">~</span>, <span class="var type0" id="S17T0U67"><span class="message error" id="M7F23C">row_index</span></span>] = min(<span class="var type0" id="S15T0U70"><span class="message error" id="M5F23C">differences</span></span>,[],2);</span></span>
<span class="srcline"><span class="lineno"><a href="18,23" id="srcline23">23</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="18,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,25" id="srcline25">25</a></span><span class="line"><span class="comment">%for every row find the column at which the x spline value is closest</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T3:U40"><span class="var type1" id="S19T3U76">x_spline_ext</span> = <span class="mxinfo " id="T3:U42">zeros(<span class="mxinfo " id="T17:U43">size(<span class="var type1" id="S10T3U81">angleKnee_spline_ext</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="18,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,28" id="srcline28">28</a></span><span class="line"> <span class="keyword">for</span> <span class="var type1" id="S14T4U84">i</span> = <span class="mxinfo " id="T1:U46"><span class="mxinfo " id="T4:U47">1</span>:<span class="mxinfo " id="T4:U48">length(<span class="var type1" id="S5T16U89">x_spline</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="18,29" id="srcline29">29</a></span><span class="line">     <span class="mxinfo " id="T16:U50"><span class="mxinfo " id="T16:U51"><span class="var type1" id="S19T3U93">x_spline_ext</span>(<span class="var type1" id="S14T4U94">i</span>,<span class="mxinfo " id="T12:U54">:</span>)</span> = <span class="mxinfo " id="T4:U55"><span class="var type1" id="S5T16U97">x_spline</span>(<span class="var type1" id="S14T4U98">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="18,30" id="srcline30">30</a></span><span class="line"> <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,31" id="srcline31">31</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="18,32" id="srcline32">32</a></span><span class="line">[<span class="message error" id="M9F23C">~</span>, <span class="var type0" id="S20T0U103"><span class="message error" id="M10F23C">column_index</span></span>] = min(abs(<span class="var type1" id="S8T3U111">table_x</span>(<span class="var type0" id="S17T0U112"><span class="message error" id="M8F23C">row_index</span></span>, :)' - <span class="var type0" id="S19T0U114">x_spline_ext</span>),[] , 2);</span></span>
<span class="srcline"><span class="lineno"><a href="18,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,34" id="srcline34">34</a></span><span class="line"><span class="comment">%now for every (knee_angle,x) we have a (row,column) number thus we can</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,35" id="srcline35">35</a></span><span class="line"><span class="comment">%look up the corresponding hip and y angles as follows:</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,37" id="srcline37">37</a></span><span class="line"><span class="var type0" id="S2T0U120">angleHip</span> = <span class="var type1" id="S6T1U122">table_hip</span>(<span class="var type0" id="S20T0U123"><span class="message error" id="M11F23C">column_index</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="18,38" id="srcline38">38</a></span><span class="line"><span class="var type0" id="S3T0U126">y</span> = zeros(length(<span class="var type0" id="S17T0U131"><span class="message error" id="M12F23C">row_index</span></span>),1);</span></span>
<span class="srcline"><span class="lineno"><a href="18,39" id="srcline39">39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="18,40" id="srcline40">40</a></span><span class="line"><span class="keyword">for</span> <span class="var type0" id="S14T0U135">i</span> = <span class="mxinfo " id="T4:U60">1</span>:length(<span class="var type0" id="S17T0U140"><span class="message error" id="M13F23C">row_index</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="18,41" id="srcline41">41</a></span><span class="line">    <span class="var type0" id="S3T0U144">y</span>(<span class="var type0" id="S14T0U145">i</span>) = <span class="var type1" id="S9T3U147">table_y</span>(<span class="var type0" id="S17T0U149"><span class="message error" id="M14F23C">row_index</span></span>(<span class="var type0" id="S14T0U150">i</span>), <span class="var type0" id="S20T0U152">column_index</span>(<span class="var type0" id="S14T0U153">i</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="18,42" id="srcline42">42</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="18,43" id="srcline43">43</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
